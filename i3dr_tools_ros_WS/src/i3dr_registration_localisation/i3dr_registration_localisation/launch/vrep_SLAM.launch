<launch>

    <param name="robot_description_deimos" command="$(find xacro)/xacro '$(find deimos)/urdf/deimos_scene.urdf.xacro'" />
    <arg name="gui" default="False" />
    <arg name="use_tf_static" default="false"/>
    <param name="use_gui" value="$(arg gui)"/>

    <node name="robot_state_publisher" pkg="robot_state_publisher" type="state_publisher">
        <remap from="robot_description" to ="robot_description_deimos" />
        <param name="use_tf_static" value="$(arg use_tf_static)"/>
    </node>

    <group ns="stereo">
        
        <node pkg="deimos" type="deimos_node" name="deimos" output="screen" required="true">
            <param name="width" type="int" value="752" />
            <param name="height" type="int" value="480" />
            <param name="fps" type="int" value="60" />
            <param name="device" type="string" value="/dev/video0" />
            <param name="exposureValue" type="int" value="1" />
            <param name="cameraLeft_info_url" type="string" value="file://${ROS_HOME}/camera_info/left.yaml" />
            <param name="cameraRight_info_url" type="string" value="file://${ROS_HOME}/camera_info/right.yaml" />
        </node>

        <node pkg="stereo_image_proc" type="stereo_image_proc" name="stereo_image_proc">
            <param name="stereo_algorithm" value="0" />
            <param name="min_disparity" value="4" />
            <param name="disparity_range" value="128" />
            <param name="correlation_window_size" value="19" />
            <param name="uniqueness_ratio" value="3"/>
            <param name="speckle_size" value="500"/>
            <param name="speckle_range" value="4"/>
        </node>

        <!--<node pkg="nodelet" type="nodelet" name="disparity2depth" args="standalone rtabmap_ros/disparity_to_depth"/>-->
    </group>
    
    <include file="$(find rtabmap_ros)/launch/rtabmap.launch">
        <arg name="args" value="--delete_db_on_start"/>
        <arg name="frame_id" value="deimos_base_link"/>
        <arg name="vo_frame_id" value="deimos_cameraLeft"/>

        <arg name="stereo" value="true"/>
        <arg name="stereo_namespace" value="/stereo"/>
           
        <arg name="rtabmapviz" value="true"/>
        <arg name="rviz" value="false"/>
    </include>
    
</launch>