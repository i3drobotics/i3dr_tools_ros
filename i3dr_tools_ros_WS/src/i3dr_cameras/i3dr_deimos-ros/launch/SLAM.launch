<?xml version="1.0"?>
<!--XML-->
<launch>

    <param name="robot_description_deimos" command="$(find xacro)/xacro '$(find deimos)/urdf/deimos_scene.urdf.xacro'" />
        <arg name="gui" default="False" />
        <arg name="use_tf_static" default="false"/>
        <param name="use_gui" value="$(arg gui)"/>

        <!--<node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher">
            <remap from="robot_description" to ="robot_description_deimos" />
        </node>
        -->
        <node name="robot_state_publisher" pkg="robot_state_publisher" type="state_publisher">
            <remap from="robot_description" to ="robot_description_deimos" />
            <param name="use_tf_static" value="$(arg use_tf_static)"/>
        </node>


    <group ns="stereo">
        
        <node pkg="deimos" type="deimos_node" name="deimos" output="screen" required="true">
            <param name="width" type="int" value="752" />
            <param name="height" type="int" value="480" />
            <param name="fps" type="int" value="60" />
            <param name="device" type="string" value="/dev/video0" />
            <param name="exposureValue" type="int" value="1" />
            <param name="cameraLeft_info_url" type="string" value="file://${ROS_HOME}/camera_info/left.yaml" />
            <param name="cameraRight_info_url" type="string" value="file://${ROS_HOME}/camera_info/right.yaml" />
        </node>

        <node pkg="stereo_image_proc" type="stereo_image_proc" name="stereo_image_proc">
            <param name="stereo_algorithm" value="0" />
            <param name="min_disparity" value="4" />
            <param name="disparity_range" value="128" />
            <param name="correlation_window_size" value="35" />
        </node>

        <!--
        <node pkg="deimos" type="generate_disparity" name="i3dr_disparity" output="screen">
            <param name="stereo_algorithm" value="0" />
            <param name="min_disparity" value="4" />
            <param name="disparity_range" value="128" />
            <param name="correlation_window_size" value="35" />
        </node>

        <node pkg="image_view" type="disparity_view" name="disparity_view">
            <remap from="image" to="/stereo/i3dr_disparity" />
        </node>
        -->

        <!-- custom point cloud generator with normals from disparity image -->
        <!--
        <node pkg="deimos" type="generate_point_cloud" name="custom_point_cloud_generator">
            <param name="disparity_node" value="/stereo/disparity" />
            <param name="point_cloud_node" value="/stereo/normalPoints2" />
        </node>
        -->

    </group>
    
   <!--<node pkg="imu_filter_madgwick" type="imu_filter_node" name="ImuFilter">
        <param name="use_magnetic_field_msg" type="bool" value="false" />
        <param name="_publish_tf" type="bool" value="true" />
        <param name="_world_frame" type="string" value="enu" />
        <remap from="/imu/data_raw" to="/stereo/imu_data"/>
    </node>
    -->
    
    

    <param name="subscribe_depth" value="false"/>
    <param name="subscribe_scan_cloud" value="true"/>
    
   <!--<include file="$(find rtabmap_ros)/launch/rtabmap.launch">
        <arg name="args" value="--><!--delete_db_on_start"/>
        <arg name="rgb_topic" value="/stereo/left/image_color"/>
        <arg name="camera_info_topic" value="/stereo/left/camera_info"/>

        <remap from="scan_cloud" to="/stereo/points2"/>

        <arg name="rtabmapviz" value="false"/>
        <arg name="rviz" value="true"/>
    </include>
    -->
    <!--
    <include file="$(find robot_localization)/launch/ukf_template.launch"/>
    <param name="/ukf_se/frequency" value="300"/>
    <param name="/ukf_se/base_link_frame" value="deimos_base_link"/>
    <param name="/ukf_se/odom0" value="rtabmap/odom"/>
    <rosparam param="/ukf_se/odom0_config">[true,true,true,
                                            true,true,true,
                                            true,true,true,
                                            true,true,true,
                                            true,true,true]
    </rosparam>
    <param name="/ukf_se/odom0_relative" value="true"/>
    <param name="/ukf_se/odom0_pose_rejection_threshold" value="10000000"/>
    <param name="/ukf_se/odom0_twist_rejection_threshold" value="10000000"/>

    <param name="/ukf_se/imu0" value="/stereo/imu_data"/>
    <rosparam param="/ukf_se/imu0_config">[false, false, false,
                                           true,  true,  true,
                                           true,  true,  true,
                                           true,  true,  true,
                                           true,  true,  true]
    </rosparam>
    <param name="/ukf_se/imu0_differential" value="true"/>
    <param name="/ukf_se/imu0_relative" value="false"/>
    <param name="/ukf_se/use_control" value="false"/>
    -->

</launch>
